<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Tateti</title>
<style>
  body{font-family:Arial;text-align:center;background:#f4f4f4}
  #board{display:grid;grid-template-columns:repeat(3,100px);gap:5px;margin:20px auto}
  .cell{width:100px;height:100px;background:#fff;font-size:50px;display:flex;align-items:center;justify-content:center;cursor:pointer}
</style>
</head>
<body>
  <h1>Tateti</h1>
  <div id="status">Conectando...</div>
  <div id="board"></div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const sala = params.get('sala');
    const playerJid = params.get('player');
    const socket = io(); // se conecta al mismo dominio /origin

    const status = document.getElementById('status');
    const board = document.getElementById('board');

    for (let i=0;i<9;i++){
      const c = document.createElement('div');
      c.className='cell';
      c.dataset.index = i;
      c.addEventListener('click', () => {
        if (c.textContent === '' && window.myTurn){
          socket.emit('move', { sala, index: i, symbol: window.symbol });
        }
      });
      board.appendChild(c);
    }

    socket.emit('join', { sala, playerJid });

    socket.on('start', data => {
      window.symbol = data.symbol;
      window.myTurn = data.turn;
      status.textContent = `Eres ${window.symbol} • ${window.myTurn? 'Tu turno':'Turno rival'}`;
    });

    socket.on('update', data => {
      board.children[data.index].textContent = data.symbol;
      window.myTurn = data.turn;
      status.textContent = window.myTurn? 'Tu turno':'Turno rival';
    });

    socket.on('end', data => {
      status.textContent = `Ganador: ${data.winnerSymbol}`;
      alert('Ganador: ' + data.winnerSymbol);
      // llamar al endpoint si queremos (no necesario, server ya notificó al bot)
    });

    socket.on('error', e => {
      status.textContent = 'Error: ' + e;
    });
  </script>
</body>
</html>
